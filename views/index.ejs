<section class="max-w-5xl mx-auto px-6 py-16">
  <div class="grid gap-10 lg:grid-cols-[1.2fr_0.8fr] lg:items-center">
    <div class="space-y-6">
      <h1 class="text-4xl md:text-5xl font-bold text-white leading-tight"><%= hero.heading %></h1>
      <p class="text-lg text-slate-300"><%= hero.subheading %></p>
      <div class="space-y-4 text-base text-slate-300 leading-relaxed">
        <% if (Array.isArray(hero.paragraphs) && hero.paragraphs.length) { %>
          <% hero.paragraphs.forEach((paragraph) => { %>
            <p><%- paragraph %></p>
          <% }) %>
        <% } %>
      </div>
      <form id="hero-subscribe" class="mt-6 flex flex-col gap-3 sm:flex-row sm:items-center">
        <input
          class="w-full sm:flex-1 rounded-md border border-slate-700 bg-slate-950 px-4 py-3 text-white focus:border-slate-500 focus:outline-none"
          type="email"
          name="email"
          placeholder="you@example.com"
          required
        />
        <input type="hidden" name="tags" value="site,hero" />
        <button
          class="w-full sm:w-auto inline-flex items-center justify-center rounded-md border border-slate-700 px-5 py-3 text-sm font-semibold text-slate-100 hover:bg-slate-800 transition"
          type="submit"
        >
          Join the newsletter
        </button>
      </form>
      <p id="hero-subscribe-feedback" class="text-sm text-slate-400"></p>
    </div>
    <div class="flex justify-center">
      <img
        src="<%= hero.image %>"
        alt="<%= hero.imageAlt %>"
        class="w-full max-w-md rounded-3xl border border-slate-800/70 shadow-xl"
        loading="lazy"
        width="640"
        height="640"
      />
    </div>
  </div>
</section>

<section id="writing" class="max-w-5xl mx-auto px-6 pb-16 border-t border-slate-800/60">
  <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
    <h2 class="text-2xl font-semibold text-white">Latest from the newsletter</h2>
    <a class="text-sm text-amber-200 hover:text-white" href="https://newsletter.memesmotivations.com/" target="_blank" rel="noopener noreferrer">See all issues →</a>
  </div>
  <div class="mt-6 grid gap-6">
    <% if (Array.isArray(newsletterPosts) && newsletterPosts.length) { %>
      <% newsletterPosts.forEach((post) => { %>
        <article class="rounded-2xl border border-slate-800/70 bg-slate-900/30 p-6">
          <p class="text-xs uppercase tracking-[0.3rem] text-slate-500">Newsletter</p>
          <h3 class="mt-3 text-xl font-semibold text-white"><%= post.title %></h3>
          <p class="mt-3 text-sm text-slate-300"><%= post.blurb || post.description %></p>
          <a class="mt-4 inline-flex items-center text-sm font-semibold text-amber-200 hover:text-white" href="<%= post.source_url %>" target="_blank" rel="noopener noreferrer">
            Read the full issue →
          </a>
        </article>
      <% }) %>
    <% } else { %>
      <p class="text-sm text-slate-400">Fetch your Substack feed from the admin to list the latest issues.</p>
    <% } %>
  </div>
</section>

<section class="max-w-5xl mx-auto px-6 pb-16 border-t border-slate-800/60">
  <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
    <h2 class="text-2xl font-semibold text-white">Recent videos</h2>
    <a class="text-sm text-amber-200 hover:text-white" href="https://www.youtube.com/@louiebacaj" target="_blank" rel="noopener noreferrer">YouTube channel →</a>
  </div>
  <div class="mt-6 space-y-5">
    <% if (Array.isArray(videos) && videos.length) { %>
      <% videos.forEach((video) => { %>
        <% const raw = (video.blurb || video.description || '').trim(); %>
        <% const short = raw.length > 180 ? raw.slice(0, 177).trim() + '…' : raw; %>
        <article class="flex flex-col gap-4 rounded-2xl border border-slate-800/70 bg-slate-900/30 p-4 sm:flex-row sm:items-center">
          <% if (video.image_url) { %>
            <a href="<%= video.source_url %>" target="_blank" rel="noopener noreferrer" class="w-full sm:w-48 flex-shrink-0">
              <img src="<%= video.image_url %>" alt="<%= video.title %> thumbnail" class="w-full rounded-xl border border-slate-800/60" loading="lazy" />
            </a>
          <% } %>
          <div class="space-y-3 flex-1">
            <h3 class="text-lg font-semibold text-white"><%= video.title %></h3>
            <% if (short) { %>
              <p class="text-sm text-slate-300"><%= short %></p>
            <% } %>
            <a class="inline-flex items-center text-sm font-semibold text-amber-200 hover:text-white" href="<%= video.source_url %>" target="_blank" rel="noopener noreferrer">
              Watch →
            </a>
          </div>
        </article>
      <% }) %>
    <% } else { %>
      <p class="text-sm text-slate-400">Fetch the YouTube feed from the admin dashboard to populate this section.</p>
    <% } %>
  </div>
</section>

<section class="max-w-5xl mx-auto px-6 pb-16 border-t border-slate-800/60">
  <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
    <h2 class="text-2xl font-semibold text-white">Open source projects</h2>
    <a class="text-sm text-amber-200 hover:text-white" href="https://github.com/lbacaj" target="_blank" rel="noopener noreferrer">GitHub profile →</a>
  </div>
  <div class="mt-6 space-y-5">
    <% if (Array.isArray(openSource) && openSource.length) { %>
      <% openSource.forEach((project) => { %>
        <% const summary = (project.blurb || '').trim() || (project.description || '').trim(); %>
        <% const shortSummary = summary.length > 180 ? summary.slice(0, 177).trim() + '…' : summary; %>
        <article class="flex flex-col gap-4 rounded-2xl border border-slate-800/70 bg-slate-900/30 p-5 sm:flex-row sm:items-start">
          <div class="flex-1 space-y-3">
            <h3 class="text-lg font-semibold text-white"><%= project.title %></h3>
            <% if (shortSummary) { %>
              <p class="text-sm text-slate-300"><%= shortSummary %></p>
            <% } %>
            <div class="flex flex-wrap gap-2 text-xs text-slate-400">
              <% if (project.tags) { %>
                <% project.tags.split(',').slice(0, 4).forEach((tag) => { %>
                  <span class="rounded-full border border-slate-700 px-3 py-1"><%= tag.trim() %></span>
                <% }) %>
              <% } %>
            </div>
            <a class="inline-flex items-center text-sm font-semibold text-amber-200 hover:text-white" href="<%= project.source_url %>" target="_blank" rel="noopener noreferrer">
              View on GitHub →
            </a>
          </div>
        </article>
      <% }) %>
    <% } else { %>
      <p class="text-sm text-slate-400">Fetch GitHub repos from the admin dashboard to highlight them here.</p>
    <% } %>
  </div>
</section>

<section class="max-w-5xl mx-auto px-6 pb-16 border-t border-slate-800/60">
  <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
    <h2 class="text-2xl font-semibold text-white">Things I'm building</h2>
    <a class="text-sm text-amber-200 hover:text-white" href="https://lbacaj.gumroad.com/" target="_blank" rel="noopener noreferrer">See all products →</a>
  </div>
  <div class="mt-6 space-y-5">
    <% if (Array.isArray(featuredApps) && featuredApps.length) { %>
      <% featuredApps.forEach((app) => { %>
        <% const summary = (app.blurb || app.description || '').trim(); %>
        <% const shortSummary = summary.length > 180 ? summary.slice(0, 177).trim() + '…' : summary; %>
        <article class="flex flex-col gap-4 rounded-2xl border border-slate-800/70 bg-slate-900/30 p-5 sm:flex-row sm:items-start">
          <% if (app.image_url) { %>
            <a href="<%= app.source_url %>" target="_blank" rel="noopener noreferrer" class="w-full sm:w-48 flex-shrink-0">
              <img src="<%= app.image_url %>" alt="<%= app.title %>" class="w-full rounded-xl border border-slate-800/60 object-cover" loading="lazy" />
            </a>
          <% } %>
          <div class="flex-1 space-y-3">
            <h3 class="text-lg font-semibold text-white"><%= app.title %></h3>
            <% if (shortSummary) { %>
              <p class="text-sm text-slate-300"><%= shortSummary %></p>
            <% } %>
            <a class="inline-flex items-center text-sm font-semibold text-amber-200 hover:text-white" href="<%= app.source_url %>" target="_blank" rel="noopener noreferrer">
              Take a look →
            </a>
          </div>
        </article>
      <% }) %>
    <% } else { %>
      <p class="text-sm text-slate-400">Add apps or products in the admin dashboard to feature them here.</p>
    <% } %>
  </div>
</section>

<section class="max-w-5xl mx-auto px-6 pb-16 border-t border-slate-800/60">
  <h2 class="text-2xl font-semibold text-white">What I've been sharing</h2>
  <div class="mt-6 grid gap-6 lg:grid-cols-3">
    <% if (Array.isArray(socialPosts) && socialPosts.length) { %>
      <% socialPosts.forEach((post) => { %>
        <article class="rounded-2xl border border-slate-800/70 bg-slate-900/30 p-6 space-y-3">
          <p class="text-xs uppercase tracking-[0.3rem] text-slate-500"><%= post.type === 'x_post' ? 'X / Twitter' : 'LinkedIn' %></p>
          <h3 class="text-base font-semibold text-white"><%= post.title %></h3>
          <p class="text-sm text-slate-300"><%= post.blurb || post.description %></p>
          <a class="inline-flex items-center text-sm font-semibold text-amber-200 hover:text-white" href="<%= post.source_url %>" target="_blank" rel="noopener noreferrer">
            View the post →
          </a>
        </article>
      <% }) %>
    <% } else { %>
      <p class="text-sm text-slate-400">Add social posts in the admin dashboard to surface them here.</p>
    <% } %>
  </div>
</section>

<section class="max-w-5xl mx-auto px-6 pb-20 border-t border-slate-800/60">
  <h2 class="text-2xl font-semibold text-white">Places I've been featured</h2>
  <div class="mt-6 grid gap-4 sm:grid-cols-3 md:grid-cols-6">
    <% const appearanceList = Array.isArray(appearedOn) && appearedOn.length ? appearedOn : features.slice(0, 6); %>
    <% if (appearanceList && appearanceList.length) { %>
      <% appearanceList.forEach((feature) => { %>
        <% const image = feature.image || feature.image_url; %>
        <% const url = feature.url || feature.source_url; %>
        <a
          href="<%= url %>"
          target="_blank"
          rel="noopener noreferrer"
          class="group flex h-24 items-center justify-center rounded-xl border border-slate-800/70 bg-slate-900/20 px-4"
        >
          <% if (image) { %>
            <img
              src="<%= image %>"
              alt="<%= (feature.alt || feature.title || 'Feature') %>"
              class="max-h-14 opacity-60 transition group-hover:opacity-100 group-hover:grayscale-0 grayscale"
              loading="lazy"
            />
          <% } else { %>
            <span class="text-xs text-slate-300"> <%= feature.title %> </span>
          <% } %>
        </a>
      <% }) %>
    <% } else { %>
      <p class="text-sm text-slate-400">Add press and podcast appearances in Settings → Homepage.</p>
    <% } %>
  </div>
</section>

<script>
  const heroSubscribe = document.getElementById('hero-subscribe');
  if (heroSubscribe) {
    heroSubscribe.addEventListener('submit', async (event) => {
      event.preventDefault();
      const feedback = document.getElementById('hero-subscribe-feedback');
      feedback.textContent = '';
      feedback.className = 'text-sm text-slate-400';
      const formData = new FormData(heroSubscribe);
      const payload = Object.fromEntries(formData.entries());
      try {
        const response = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        if (response.ok) {
          feedback.textContent = 'Thanks! Check your inbox soon.';
          feedback.className = 'text-sm text-amber-200';
          heroSubscribe.reset();
        } else {
          const error = await response.json();
          feedback.textContent = error.error || 'Unable to subscribe right now.';
          feedback.className = 'text-sm text-rose-300';
        }
      } catch (error) {
        feedback.textContent = 'Network error. Please try again.';
        feedback.className = 'text-sm text-rose-300';
      }
    });
  }

  const subscribeForm = document.getElementById('subscribe-form');
  if (subscribeForm) {
    subscribeForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const feedback = document.getElementById('subscribe-feedback');
      feedback.textContent = '';
      feedback.className = 'text-sm text-slate-300';
      const formData = new FormData(subscribeForm);
      const payload = Object.fromEntries(formData.entries());
      try {
        const response = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        if (response.ok) {
          feedback.textContent = 'Thanks! Check your inbox for a welcome message soon.';
          feedback.className = 'text-sm text-emerald-300 mt-2';
          subscribeForm.reset();
        } else {
          const error = await response.json();
          feedback.textContent = error.error || 'Unable to subscribe right now.';
          feedback.className = 'text-sm text-rose-300 mt-2';
        }
      } catch (error) {
        feedback.textContent = 'Network error. Please try again.';
        feedback.className = 'text-sm text-rose-300 mt-2';
      }
    });
  }
</script>
